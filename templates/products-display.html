{% extends 'base.html' %}
{% load static %}

{% block content %}

<section class="text-gray-600 body-font">

  <form id="sort-form" action="{% url 'products-list' %}" method="get">
    <input id="query-input" type="text" name="query" hidden/>
    <label for="sort_by">Sort by:</label>
    <select name="sort_by" id="sort_by">
      <option value="descending">Price (descending)</option>
      <option value="ascending">Price (ascending)</option>
    </select>
  </form>

  <div class="container px-5 py-24 mx-auto">
    <div class="flex flex-wrap -m-4">
      {%for prod in prods_list%}
      <div class="lg:w-1/4 md:w-1/2 p-4 w-full">
        <a class="block relative h-48 rounded overflow-hidden">
          <img alt="ecommerce" class="object-cover object-center w-full h-full block" src="{{prod.image}}">
        </a>
        <div class="mt-4">
          <h3 class="text-gray-500 text-xs tracking-widest title-font mb-1">{{prod.category_tree}}</h3>
          <h2 class="text-gray-900 title-font text-lg font-medium">{{prod.name}}</h2>
          <div class = "flex justify-between">
            <p class="mt-1">{{prod.retail_price}}</p>
            <form action="{% url 'add_to_cart' id=prod.id %}" method="post">
              {% csrf_token %}
            <button type="submit" class="flex ml-4 text-white bg-indigo-500 border-0 py-2 px-6 focus:outline-none hover:bg-indigo-600 rounded">Add to Cart</button>
          </form>
            </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>

  {% comment %} Pagination code from the django docs {% endcomment %}
  <div class="pagination">
    <span class="step-links">
        {% if page_obj.has_previous %}
            <a href="?page=1">&laquo; first</a>
            <a href="?page={{ page_obj.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}">next</a>
            <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
    </span>
  </div>

</section>

<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<script>
  const url = new URL(window.location.href);
  const query = url.searchParams.get('query');
  const current_sort = url.searchParams.get('sort_by');
  if (current_sort == null) {
    $('#sort_by').val("descending");
  } else {
    $('#sort_by').val(current_sort);
  }
  $('#query-input').value = query;
  $('#sort_by').change(() => {
    $('#sort-form').submit();
  })

</script>

{% endblock content %}